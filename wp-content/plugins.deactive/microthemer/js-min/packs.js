jQuery(document).ready(function(e){var a=window.parent.TvrMT,t=a.TvrUi,o=a.TvrCom,n=(a.tvrsprintf,window.parent.TvrLang);t.templates=a.data.templates;var i={init:function(){a.data.prog.combo.packTypes=[n.theme_skin,n.plugin_skin,n.theme_scaffold,n.plugin_scaffold],a&&o.isDomEl(e("#update-packs-list"))&&t.update_packs_obj(e("#update-packs-list").attr("rel")),e("input.combobox").live("focus",function(){var o=e(this);o.autocomplete({source:a.data.prog.combo[o.attr("rel")],delay:0,minLength:0,appendTo:o.parent(".tvr-input-wrap"),open:function(e,a){o.next(".combo-arrow").addClass("on")},select:function(e,a){var n=t.get_manual_wrap_class(o);if(o.val(a.item.value),o.closest(n).addClass("manual-val").find(".comp-style").addClass("hidden").end().find(".combo-arrow").removeClass("on"),"css_unit_set"===o.attr("id")){var i=o.val();o.closest("ul").find("input.custom_css_unit").val(i)}},search:function(e,a){o.addClass("adjusted-corner-radius")},close:function(e,a){o.removeClass("adjusted-corner-radius").next(".combo-arrow").removeClass("on")}})}),e("span.combo-arrow").live("mousedown",function(){e(this).siblings(".ui-menu").is(":visible")&&(i.wasOpen=!0)}),e("span.combo-arrow").live("click",function(){var a=e(this),t=a.prev();if(i.wasOpen)return a.removeClass("on"),void(i.wasOpen=!1);a.addClass("on"),t.focus().autocomplete("search","")}),e("#tvr").click(function(a){var o=e(a.target);try{if(!(r=o.attr("class")))var r="tvr-undefined"}catch(e){}if(r.indexOf("pack-action")>=0||r.indexOf("pack-icon")>=0||r.indexOf("action-text")>=0){var l=o.closest(".pack-action");i.pack_button_action(l)}else r.indexOf("delete-pack-multi")>=0?i.delete_pack(o,"multi"):r.indexOf("download-pack-multi")>=0?i.download_pack(o,"multi"):r.indexOf("combobox")>=0?i.combobox_clicked(o):r.indexOf("delete-file")>=0?i.delete_file(o,a):r.indexOf("show-dialog")>=0?i.show_dialog(o):r.indexOf("show-parent-dialog")>=0?(t.show_dialog(o),"import-from-pack"==o.attr("rel")&&t.set_import_field(o.data("pack-name"))):r.indexOf("close-dialog")>=0||r.indexOf("tvr-dialog")>=0?i.close_dialog(o):r.indexOf("color-img")>=0?i.color_img(o):r.indexOf("fake-checkbox")>=0||r.indexOf("fake-radio")>=0?i.toggle_radio_checkbox(o):r.indexOf("upload-pack")>=0?e("#upload_pack_input").val()||(alert(n.select_zip),a.preventDefault()):r.indexOf("dialog-tab")>=0&&r.indexOf("dialog-tabs")<0?i.dialog_tab_pressed(o):r.indexOf("reveal-hidden-form-opts")>=0?i.reveal_form_opts(o):r.indexOf("save-preferences")>=0&&i.save_preferences(o)})},escape_backslashes:function(e,a){return a?e.replace(/%5C/g,"%26%2392%3B"):e.replace(/\\/g,"&#92;")},save_preferences:function(a){var t=e("#ajaxUrl").attr("rel"),o=e("#returnUrl").attr("rel"),r=n.saving_preferences,l=i.escape_backslashes(e("#tvr-preferences").serialize(),!0);i.general_ajax_submission("Preferences save",t,o,r,"POST",l,a)},general_ajax_submission:function(a,o,r,l,s,d,c){c.after(e(t.templates.loaders.default)).clone().removeAttr("id").attr("title",n.saving_preferences),e.ajax({type:s,url:o,data:d,timeout:t.tOut,error:function(a,t){e("img.ajax-loader").remove(),alert(i.handle_ajax_error(a,t))},success:function(){window.location=r}})},reveal_form_opts:function(e){var a=e.attr("rel");e.closest("li").siblings(".hidden."+a).addClass("show")},dialog_tab_pressed:function(e){var a=e.closest(".dialog-main"),t=a.find(".dialog-tabs"),o=e.attr("rel");i.update_tab(a,".dialog-tab-field",t,o,".dialog-tab",".dummy-for-now")},update_tab:function(e,a,t,o,n,i,r){t.find(n).removeClass("active").end().find(n+"-"+o).addClass("active").end().find(i).val(o),r||e.find(a+".show").removeClass("show").end().find(a+"-"+o).addClass("show")},color_img:function(a){e.colorbox({maxWidth:"97%",maxHeight:"90%",href:a.attr("src"),open:!0})},combobox_clicked:function(e){e.autocomplete("search","").next(".combo-arrow").addClass("on")},pack_button_action:function(a){var t=a.attr("rel");if("info"==t||"attachments"==t||"instructions"==t){e("#main-theme-actions").find(".pack-action").removeClass("on"),e("#single-content-areas").find(".manage-content-wrap").removeClass("show");e("#main-theme-actions").find("li.pack-action-"+t).addClass("on"),e("#edit-"+t).addClass("show")}else"download"==t?i.download_pack(a,"single"):"delete"==t&&i.delete_pack(a,"single")},download_pack:function(a,o){var r=e("#zip-folder").attr("rel"),l=a.attr("data-dir-name"),s=r+l+".zip";"single"==o?a.after(e(t.templates.loaders.wbg).attr("id","loading-gif-active")):a.before(e(t.templates.loaders.wbg).attr("id","loading-gif-active"));var d=e("#ajaxUrl").attr("rel")+"&mt_action=tvr_download_pack&dir_name="+l;e.ajax({type:"GET",url:d,async:!0,timeout:2e4,error:function(a,o){var r=e(t.templates.log_item).removeAttr("id");r.find(".short").text("Download failed").end().find(".long").html("<p>"+n.download_failed+"</p><p>"+i.handle_ajax_error(a,o)+"</p>"),e("#full-logs").html('<ul class="logs"></ul>').find("ul").append(r).focus()},success:function(a){var t=e(a).find("#microthemer-notice");"1"===e(a).find("#download-status").attr("rel")?location.href=s:e("#full-logs").html(t.html()).focus()},complete:function(){e("#loading-gif-active").remove()}})},delete_pack:function(a,o){if(!confirm(n.delete_pack_confirm))return!1;"single"==o?a.after(e(t.templates.loaders.wbg).attr("id","loading-gif-active")):a.before(e(t.templates.loaders.wbg).attr("id","loading-gif-active"));var r=a.attr("data-dir-name"),l=e("#ajaxUrl").attr("rel")+"&mt_action=tvr_delete_micro_theme&dir_name="+r,s=e("#delete-ok").attr("rel");e.ajax({type:"GET",url:l,async:!0,timeout:2e4,error:function(a,o){var r=e(t.templates.log_item).removeAttr("id");r.find(".short").text("Delete failed").end().find(".long").html("<p>"+n.delete_pack_failed+"</p><p>"+i.handle_ajax_error(a,o)+"</p>"),e("#full-logs").html('<ul class="logs"></ul>').find("ul").append(r).focus(),e("#loading-gif-active").remove()},success:function(t){var n=e(t).find("#microthemer-notice");if("1"===e(t).find("#delete-status").attr("rel"))if("single"==o)window.location=s;else{e("#loading-gif-active").remove(),a.closest("li").fadeOut("slow");var i=e("li.last-modified");i.attr("rel")==r&&i.remove()}else e("#full-logs").html(n.html()).focus()},complete:function(){}})},handle_ajax_error:function(e,a){return 0==e.status?n.error_connection:404==e.status?n.error_404:500==e.status?n.error_500:"parsererror"==a?n.error_parser:"timeout"==a?n.error_timeout:n.error_unknown+"\n"+e.responseText},export_zip_button:function(a,t){"warn"==e("span#external-notice").text()&&(confirm(n.external_notice)||t.preventDefault())},delete_file:function(e,a){confirm(n.delete_file_confirm)&&(window.location=e.attr("data-href"))},show_dialog:function(a){i.close_dialog();var t=a.attr("rel");if("not-yet"==t)return!1;var o=a.attr("data-ext"),r=a.attr("data-href")+"?nomtcache="+(new Date).getTime();if("view-pack-file"==t)if("image"==o)e.colorbox({maxWidth:"97%",maxHeight:"90%",href:r,open:!0});else{var l=["txt","json","css","html"];jQuery.inArray(o,l)<0?alert(n.view_pack_failed):i.ajax_load_pack_file(a,r)}},close_dialog:function(){e("#tvr").find("div.tvr-dialog").removeClass("show")},toggle_radio_checkbox:function(e){var a=e.prev();if(a.is(":checked")){if(e.hasClass("fake-radio"))return!1;a.prop("checked",!1),e.removeClass("on")}else e.hasClass("fake-radio")&&e.closest(".fake-radio-parent").find('input[type="radio"]').prop("checked",!1).end().find(".fake-radio").removeClass("on"),a.prop("checked",!0),e.addClass("on")},ajax_load_pack_file:function(a,o){a.attr("data-base-name");a.after(e(t.templates.loaders.mgbg).attr("id","loading-gif-active")),e.ajax({type:"GET",url:o,async:!1,dataType:"text",timeout:2e4,error:function(a,r){var l=e(t.templates.log_item).removeAttr("id");l.find(".short").text(n.delete_failed).end().find(".long").html("<p>"+n.unable_load+o+"</p><p>"+i.handle_ajax_error(a,r)+"</p>"),e("#full-logs").html('<ul class="logs"></ul>').find("ul").append(l).focus()},success:function(a){var t="#pack-file-content";e(t).html(a),e.colorbox({width:"80%",height:"80%",html:e(t).clone().attr("id","pack-file-content-active"),onClosed:function(){},open:!0})},complete:function(){e("#loading-gif-active").remove()}})}};i.init(),{init:function(){e("#tvr-preferences").click(function(a){var t=e(a.target);try{if(!t.attr("class"));}catch(e){}})}}.init();var r={init:function(){e("#tvr-docs").click(function(a){var t=e(a.target);try{if(!(o=t.attr("class")))var o="tvr-undefined"}catch(e){}(o.indexOf("css-group-heading")>=0||o.indexOf("accordion-menu-arrow")>=0||o.indexOf("pg-icon")>=0||o.indexOf("text-for-group")>=0)&&(t=t.closest(".css-group-heading"),r.update_accordion(t,e("#tvr-docs")))})},update_accordion:function(e,a){var t=a.find("li.accordion-item"),o=e.parent();if(o.hasClass("show-content"))var n=!0;return a.find(".accordion-menu-arrow.on").removeClass("on"),t.slideUp(function(){a.find(".show-content").removeClass("show-content")}),!n&&(o.find(".accordion-menu-arrow").addClass("on"),e.siblings("li.accordion-item").slideDown(function(){o.addClass("show-content")}),!1)}};r.init()});